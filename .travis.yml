env:
  global:
  - secure: acaEAZ3z/JFRfvzPn0b3gKyMOy+jR/7ApzvJ25eqwK0zy4C3oEku7WpHYpldJaTJqvzojLeTs6pGmLGbdasKwhavkSyCwEC/cMtbaR/P9hIYjBFtOPXSuL0y44ojGM7aYjqkRpvOUGensbypR+2l0w43L1GwlEmqO44B/yBFN0ILpZYFVAOl4c3Om8ef+aGWXbsVTCG2Q1N7Rq8/cPROZ2VkAzjasnN5QjIbPfBk31GFc7pv6xRnzIsmSSJHz2XcTeh4p259Evnb7ztsi5rJTtK/gDba2ptZk3LrpFiozA2sjFSdj8puE0jsfCE28XbrwpSbkNqnUysAS17Os1tJHtGGlsDNfU8Ixpt67Dpz92D1T8rRjA26dLlHslgnOXHPfWKgiTFBAjMAk3ZCIWFeIog2Kumog5AI6mTo2AyoiEXbz4w9SPkE8z/MIQxAvtTOOZX3f39xKUzqI3VlNCkattro9MonvjV+pDkJ8pOIIlwJpHZJD21Rf9bPrky4H6Jw4e/duGmvcggkocOzcDxQpa+TddyKh9Kv8orkJhD1+JRwGO8iNU4az+5OjHy3NhA7WK9FeOcJnPbWxBB2tikMFIpHY7MFHaoJckt43/+AYscf16P0mrQkl2MnaMm7eZHCqH0J5FRNdmw3NreC/Vk36xSPZ2DmxjttIq7q0sf0bYI=
  - secure: qvasQok6Yay+Vh7XwZpFjF0cta2UgFaxnDuIwJFYwOxmzWuhG/2EYbBHMVDxB+Ozi1CUjami/tRGecXuxnNHgRmepcmZB30WkwWkAsVxK2WAB0hdpGs+2w/OAxENFkPuK4uYPA1o6RP/AetAm0FZQF8F1JKNA92pWToW4vDqHvQnHAHOlCl5hfhgjfrDlI3npC2lfqteyeAOMasrk3fQPNh7LOyInfqMrSdrCgARokG/h3AgP559/VDB+n55uWc7pJLy9TPACDaizg2hwPxqb+mqBiXbJ3y0378dHj7+nUgJf8AraGJdTZ0DXqc8QdcBuTQ2rf4YUpTMEP5uO4gRsXpRdwaO2r2YViBA+EStmOY9/A6k1xP/Rn0PDdN4zJdasm5oEae8y0DgGLVBrAhsCL7Iaa1K4M+VwwZjSd1UXePpDDTu9uyhKK5tbbCprIhIdevasCi9VW0Ze/vB86I8DQ5TZdGimNdRcSXkwhBksNyNGiFdje8vfaCfnwpNntG7vHvjLMIQxqPQd3Gb7Hcsk6mrNmcUpNNimCGA46YnNgXvikHMNplHNctiZPKV1w1ovlCMBn/IL6wg/YUncLae/gFyJ53nE4cmY8SNwg9Ne/oBXBSdb+aTbHESj54hNz5GaxGOHrN4NIrDGfu207mmYxmaUWxWI4jjDgZ0+8E+rR4=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: o5qVhAqVcLyJxBMyfFfi5xW9k2CGIsKyOdnuVs3NhjHyOvjtSA9TdSOoocy0oIhx3SkVfM0ZDMrUfOdmAXqr3aLQXhWUfrOe1/MKTb3lq8PviH5BTM16kZNFvFaZYMRmrmzmlvnwNr/Ho6tcHR92jko+Gj/0EIdITcNfdBzx3QPrKYWRd2J/kaJT25PIFBo57U/T+yNn2D7k6ZkMmwv6rAXTw5JAon9V2yW2gLxJSsaWkMXj9Dm49A7f6d+LMKK0iD1R4okkEiPNvcRqKNtl9EkOlb1CmgY7iONoocuz7hCL1uO3Rp2RB0Th/eaduvQNCvz/QFbk6BcBCGjF3mNYhLj1zmTa08upkpxFLSfK6H0PNtaGZBsAooWlLMIT1e/87P9TNuzsbwkb5i8lNvYY2fVqv0cYGVkIr0ZOmeW82B2N0nK/0aYGHtIq7JvMnVzHUnMlJOy0R/fxfasX5m4xw2KEB0zP43LoZPbrlXtFdAf7EG0h7MWBoCkQXwnsDtFgwvXPn4Gk+h7yVDoSPFosmzpir4460avC1CjWjbP2wUNXSusfWSLmLmo+EafBxrF1x1Xrbo1kzxMgv/WxM1cAu12+Ix6OKiSftuzPcqgwH07TSF8lrBJaO/KZHwSF0MfawC44g6xY5AOZJqCmsSdogB0OezHddGCCB2UCpDI7sMg=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: dtm2NCdQ+kTEFqxkYKqNVrs20jpjz7DJGV4ZGqOdfZ6zplKIk1aztgO6gWHb6j1m9HlBVRGbslHhPS5uEOmXxNkkdjag5x8sv255IF1vO5UPY0FAvML754JCKYU+ILYWBxTv5Kfp/cBeVMF/i9HEPwOze/6EOybc+A80ErH709jXKla2kDopZ8QIP8+jGSz27b3S+CHV00g7G/wm41KP6woQ/Z9mlK7h3TMjX31hqcBdbW23HLkRHVtX2cHAIdx3XssK7f1+q11EB7W7TevhDcHg1h3MAUZ13vJWhOGTr7JazUZrLyHRZrlYP/BW43hU3RFHm8GWGbUkmmkpBocJtI/vMOCwR3Lk7kCMqKrOuUq6qHVraHCgdXTPlFPMHIoXKyQNDgSYDMdJobvTbcqZgUV7Rs74XmzsvtzmVJPgM8W+myLP93ZGDqDxpkov/C34B5QwYSaSe+CtUWlLOo+S2qxIWPv2pju81W34PZRJqJKRioIEcRWUdX3h0YeXUUJJZqQ84xa1F+VjMtPcGI70eG5PaEG1F+EOazvyo3YgCZde6e48pk0gWeOVLIePFRRB2Ym1hqlVqIvhAZcIPyGNI0AXHP8tVYei+Ap1B7+XFTBWnKJYuoH7X/GZVYnL/XAijtRoXHxHpQvlO/5u5/gZYiTzXSnmSEanqPscX/ElUQc=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
