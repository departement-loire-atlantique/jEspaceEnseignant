env:
  global:
  - secure: acaEAZ3z/JFRfvzPn0b3gKyMOy+jR/7ApzvJ25eqwK0zy4C3oEku7WpHYpldJaTJqvzojLeTs6pGmLGbdasKwhavkSyCwEC/cMtbaR/P9hIYjBFtOPXSuL0y44ojGM7aYjqkRpvOUGensbypR+2l0w43L1GwlEmqO44B/yBFN0ILpZYFVAOl4c3Om8ef+aGWXbsVTCG2Q1N7Rq8/cPROZ2VkAzjasnN5QjIbPfBk31GFc7pv6xRnzIsmSSJHz2XcTeh4p259Evnb7ztsi5rJTtK/gDba2ptZk3LrpFiozA2sjFSdj8puE0jsfCE28XbrwpSbkNqnUysAS17Os1tJHtGGlsDNfU8Ixpt67Dpz92D1T8rRjA26dLlHslgnOXHPfWKgiTFBAjMAk3ZCIWFeIog2Kumog5AI6mTo2AyoiEXbz4w9SPkE8z/MIQxAvtTOOZX3f39xKUzqI3VlNCkattro9MonvjV+pDkJ8pOIIlwJpHZJD21Rf9bPrky4H6Jw4e/duGmvcggkocOzcDxQpa+TddyKh9Kv8orkJhD1+JRwGO8iNU4az+5OjHy3NhA7WK9FeOcJnPbWxBB2tikMFIpHY7MFHaoJckt43/+AYscf16P0mrQkl2MnaMm7eZHCqH0J5FRNdmw3NreC/Vk36xSPZ2DmxjttIq7q0sf0bYI=
  - secure: qvasQok6Yay+Vh7XwZpFjF0cta2UgFaxnDuIwJFYwOxmzWuhG/2EYbBHMVDxB+Ozi1CUjami/tRGecXuxnNHgRmepcmZB30WkwWkAsVxK2WAB0hdpGs+2w/OAxENFkPuK4uYPA1o6RP/AetAm0FZQF8F1JKNA92pWToW4vDqHvQnHAHOlCl5hfhgjfrDlI3npC2lfqteyeAOMasrk3fQPNh7LOyInfqMrSdrCgARokG/h3AgP559/VDB+n55uWc7pJLy9TPACDaizg2hwPxqb+mqBiXbJ3y0378dHj7+nUgJf8AraGJdTZ0DXqc8QdcBuTQ2rf4YUpTMEP5uO4gRsXpRdwaO2r2YViBA+EStmOY9/A6k1xP/Rn0PDdN4zJdasm5oEae8y0DgGLVBrAhsCL7Iaa1K4M+VwwZjSd1UXePpDDTu9uyhKK5tbbCprIhIdevasCi9VW0Ze/vB86I8DQ5TZdGimNdRcSXkwhBksNyNGiFdje8vfaCfnwpNntG7vHvjLMIQxqPQd3Gb7Hcsk6mrNmcUpNNimCGA46YnNgXvikHMNplHNctiZPKV1w1ovlCMBn/IL6wg/YUncLae/gFyJ53nE4cmY8SNwg9Ne/oBXBSdb+aTbHESj54hNz5GaxGOHrN4NIrDGfu207mmYxmaUWxWI4jjDgZ0+8E+rR4=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: lPKLso96q50nFhLtqUxIjmdsG678oEfOGLBDe36h7GA+sZFO8y1GLJlNFSMMsjAtSWBz0YOfruo1tXKqDMO31KOgn2DfEA2b8rQgybo98VqHS+SP8cS43QHvpDaMkWH7wKw13ocWJBkBBio4gUmH7O2bFYH2puSMeDKnf6pbds3tKhno+/pe7YF3RfESjIuYQwk9FOe4yxNq5c04/Bt+uv6R9oP39ixx2sWH7ddYWka/5epCDgBlTUEeGxpmBfj6O21TgwNEl5BaU+CFZp4kXm4fYeFYtGBuPopLpcWq813LLAU0BLt5UAN9X9NqIYi8hRfbcng0KFepS/k/4Ia6D7WcGcTFyM9y/IDczdZE99ys/tOPTDVanMRDmqq2HnWJo2Ify11SJ2UFXNKgUUc72xb0b9bsYlR+NOFTyR+5UCPW3teIuB0GDN2eXY0UfBVOhex6s5mbm2kBDWvmW9iNgXEzFlk0L/I6+y1OAvaaYRRHZ8acyidap5i3EoeA1zVS7ydXe0QZ4Ckd8Wk5DKuiK2JuU4AvEIOo9VqLE74kbWsESfjeosx+Rhczc06WXKOzVSB2/jmljmLNaQ1fcDf1zuCnseUCcUCmRKTmTE/pEDOLbphU3qw4GviJ5NKicLKNk90xEk2lNL46XpivE5+a0BTDOr80WGjww+9CuUpMqjc=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: WMREs0E0dFl1SVGWhtVXxZXqwJWr5AWdn2yX6CARO9UnrKtZKdJF2Z8qmUPBBuds9a36gs3zvRL7tsnGKfv6i7FAJNv0XCFm2m5jkSO2orUes186U0tY01qSkEtPrnu9NkNeU9cZdm+4pkbBxnsh8rvTDLFDklUfjKIMcdr0xTl1XFvHGTjjHm+z4NKOuKmsXvflXAKSOzmTdoSWDGNZOMpwsyHmSi+vuE4ncucu/daLR9kREUbJxmTIw2XMDhm+OnFX2RjiGQ4s8zgxJKgtzgEnTawMQjO6Xsq7MQmYEnkzVkx9rIJ2b/GGxdzgK81MKRWWlKBGJvWjaEqMxHZ+SSV8fOsfwKxq4+oQ+/R56sr6jfUYNEkkNycBOdx2Yvvl9nHTxxNxRVYir+puNLIEl9ZR6fxl4OlAWy4DJBjQH4jrHwqCNmUxvzJ2G8T7viDY6t3KC6glLGPDDuHD4nf63aGBScCNw2qnZpMbgOZvo7Iegyhr/AzoQhMtkiwFQ6dFO1r0UAN/zmTTXnwjbeuhrO1D+gP5LNNapUf/N2Bt+QJBE+VvbF/AF1Z1N82XSu+VqFbZR6lpu0A686VgWrwXrB4ZEPc0ctg2XezgwzN3j1ruKZh5RuClfilQJY/e4oZ0k2Qnv8KuO2f2mxde6wcaCreBusY6ugeAOgQKD3Au/q4=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
